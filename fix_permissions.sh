#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª–∞–º –ø—Ä–æ–µ–∫—Ç–∞

echo "üîß –ò—Å–ø—Ä–∞–≤–ª—è–µ–º –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª–∞–º..."

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–ø—É—â–µ–Ω –ª–∏ —Å–∫—Ä–∏–ø—Ç –æ—Ç root
if [ "$EUID" -ne 0 ]; then
    echo "‚ö†Ô∏è  –î–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –Ω—É–∂–Ω—ã –ø—Ä–∞–≤–∞ root"
    echo "–ó–∞–ø—É—Å—Ç–∏—Ç–µ: sudo ./fix_permissions.sh"
    exit 1
fi

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞ –¥–ª—è —Ñ–∞–π–ª–æ–≤ –¥–∞–Ω–Ω—ã—Ö
echo "üìÅ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–∞–≤–∞ –¥–ª—è —Ñ–∞–π–ª–æ–≤ –¥–∞–Ω–Ω—ã—Ö..."

# –°–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª hidden_products.json –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
if [ ! -f "hidden_products.json" ]; then
    echo "üìù –°–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª hidden_products.json..."
    echo '{"hidden_products": []}' > hidden_products.json
fi

# –°–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª orders.json –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
if [ ! -f "orders.json" ]; then
    echo "üìù –°–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª orders.json..."
    echo '[]' > orders.json
fi

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
chmod 664 hidden_products.json
chmod 664 orders.json
chmod 664 store-7407308-202509021623.csv

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤–ª–∞–¥–µ–ª—å—Ü–∞ (–∑–∞–º–µ–Ω–∏—Ç–µ 'www-data' –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –ø–æ–¥ –∫–æ—Ç–æ—Ä—ã–º –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ)
if id "www-data" &>/dev/null; then
    chown www-data:www-data hidden_products.json
    chown www-data:www-data orders.json
    chown www-data:www-data store-7407308-202509021623.csv
    echo "‚úÖ –ü—Ä–∞–≤–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è www-data"
elif id "nginx" &>/dev/null; then
    chown nginx:nginx hidden_products.json
    chown nginx:nginx orders.json
    chown nginx:nginx store-7407308-202509021623.csv
    echo "‚úÖ –ü—Ä–∞–≤–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è nginx"
else
    echo "‚ö†Ô∏è  –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ www-data –∏ nginx –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"
    echo "–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –≤–ª–∞–¥–µ–ª—å—Ü–∞ –≤—Ä—É—á–Ω—É—é:"
    echo "chown USER:GROUP hidden_products.json orders.json store-7407308-202509021623.csv"
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
echo "üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞:"
ls -la hidden_products.json orders.json store-7407308-202509021623.csv

echo "‚úÖ –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã!"
echo ""
echo "üìã –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –æ—Å—Ç–∞–µ—Ç—Å—è, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:"
echo "1. –ü–æ–¥ –∫–∞–∫–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ"
echo "2. –õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è: docker-compose logs -f –∏–ª–∏ journalctl -u metriks -f"
echo "3. –ü—Ä–∞–≤–∞ –Ω–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞"
